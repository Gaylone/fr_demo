<!DOCTYPE html >
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <base th:href="${#request.getContextPath()}+'/'">
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <link th:href="@{asserts/css/SYSFrame.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{asserts/font/iconfont.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{asserts/css/module.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{asserts/css/pages.css}" rel="stylesheet" type="text/css" />
    <link th:href="@{asserts/css/bootstrap.min.css}" rel="stylesheet" type="text/css" />
    <title>病历管理</title>
    <script th:src="@{asserts/js/jquery-3.4.1.min.js}" type="text/javascript"></script>
    <script th:src="@{asserts/js/bootstrap.min.js}" type="text/javascript"></script>
    <script th:src="@{asserts/js/jquery.nicescroll.js}" type="text/javascript"></script>
    <script th:src="@{asserts/js/HUpages.js}" type="text/javascript"></script>
    <script th:src="@{asserts/js/other/case.js}" type="text/javascript"></script>
    <script th:src="@{asserts/js/template.js}" type="text/javascript"></script>
    <script th:src="@{asserts/js/common.js}" type="text/javascript"></script>
    <script th:src="@{asserts/js/wangeditor/wangEditor.min.js}" type="text/javascript"></script>
    <!--[if lt IE 9]>
    <script th:src="@{asserts/js/html5shiv.js}" type="text/javascript"></script>
    <script th:src="@{asserts/js/css3-mediaqueries.js}"  type="text/javascript"></script>
    <![endif]-->


</head>

<body id="situation" class="pagebox">
<div class="pages-style">
    <!--左侧菜单栏-->

    <!--右侧内容-->
    <div class="bk-con-message message-section" id="iframe_box">
        <!--编辑内容-->
        <div class="operation  mb15 relative">
            <button  class="btn button_btn bg-deep-blue menuUl_title" type="button" data-toggle="modal" data-target="#myModal" title="添加农户">
                <i class="iconfont"></i>&nbsp;新建病历
            </button>

        </div>

        <!-- Modal -->
        <div class="modal fade bs-example-modal-lg" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">病历内容</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label >病历标题</label>
                            <span id="titleMsg" class="message"></span>
                            <input type="text" class="form-control" id="title" placeholder="病历标题">
                        </div>
                        <div class="form-group">
                            <label >求助农户</label>
                            <select name="farmer" id="farmer" class="form-control">
                                <option id="farmer_opt">请选择一个农户</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label >名下池塘</label>
                            <select name="ponds" id="ponds" class="form-control">
                                <option id="ponds_opt">请选择名下池塘</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label >疾病(如果没有找到，请到渔病管理处新增)</label>
                            <select name="disease" id="disease" class="form-control">
                                <option id="disease_opt">请选择一种疾病</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label >病情描述</label>
                            <span id="contentMsg" class="message"></span>
                            <div id="div1">

                            </div>
                        </div>
                        <div class="form-group">
                            <label >损失:元(买药钱也算损失)</label>
                            <span id="lossMsg" class="message"></span>
                            <input type="text" class="form-control" id="loss" placeholder="经济损失">
                        </div>
                        <div class="form-group">
                            <label >处理方案</label>
                            <span id="solutionMsg" class="message"></span>
                           <textarea class="form-control" rows="3" id="solution"></textarea>

                        </div>



                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" id="saveCase">保存</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal -->
        <div class="modal fade bs-example-modal-lg" id="detail" tabindex="-1" role="dialog" aria-labelledby="detailLabel">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="detailLabel">病历内容</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label >病历标题:<span id="titleLab"></span></label>

                        </div>
                        <div class="form-group">
                            <label >求助农户: <span id="farmerLab"></span> </label>
                        </div>
                        <div class="form-group">
                            <label >农户联系方式: <span id="FarmerPhoneLab"></span> </label>
                        </div>
                        <div class="form-group">
                            <label >池塘: <span id="pondLab"></span></label>
                        </div>
                        <div class="form-group">
                            <label >池塘地址: <span id="pondAddressLab"></span></label>
                        </div>
                        <div class="form-group">
                            <label >疾病:<span id="diseaseLab"></span></label>

                        </div>
                        <div class="form-group">
                            <label >病情描述</label>

                            <div id="content">

                            </div>
                        </div>
                        <div class="form-group">
                            <label >损失:  <span id="lossLab" class="message"></span>元</label>

                        </div>
                        <div class="form-group">
                            <label >处理方案</label>
                            <span id="solutionLab"></span>
                        </div>
                        <div class="form-group">
                            <label >诊断人:<span id="techManLab"></span></label>

                        </div>
                        <div class="form-group">
                            <label >诊断人联系方式: <span id="techManPhoneLab"></span></label>

                        </div>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
        </div>
        <!--列表内容-->
        <div class="page_content clearfix mb15 table-module ">
            <table class="gallery table table_list table_striped table-bordered " id="tableList">
                <thead>
                <tr>
                    <th width="5%">编号</th>
                    <th  width="30%">标题</th>
                    <th  width="20%">池塘</th>
                    <th  width="20%">日期</th>
                    <th  width="20%">操作</th>
                </tr>
                </thead>
                <tbody id="productlist">
                <tr class="relative" th:each="case,casePOJOs:${casePOJOList}">
                    <td th:text="${case.cid}"></td>

                    <td th:text="${case.title}"></td>
                    <td th:text="${case.pName}"></td>
                    <td th:text="${case.date}"></td>
                    <td>
                        <a th:onclick="showDetail([[${case.cid}]])">查看详情</a>
                    </td>
                </tr>
                </tbody>
            </table>

        </div>
    </div>
</div>
</body>

</html>

<script>
    $(function() {
        //内页框架结构编辑
        $("#situation").Hupage({
            slide: '#breadcrumb',
            padding: 15,
            menuModule: '#bk-con-menu', //菜单模块
            pagecontent: '.page_content', //自定义属性
            operation: '.operation', //自定义属性
            scrollbar: function(e) {
                e.niceScroll({
                    cursorcolor: "#dddddd",
                    cursoropacitymax: 1,
                    touchbehavior: false,
                    cursorwidth: "3px",
                    cursorborder: "0",
                    cursorborderradius: "3px",
                });
            },
            expand: function(thisBox, settings) {
                var pc = "";
                $(settings.pagecontent).css("margin-bottom") != null ? pc = parseInt($(settings.pagecontent).css("margin-bottom").replace("px", "")) : '';
                $(settings.pagecontent).css({
                    height: $(window).height() - $(settings.operation).outerHeight() - pc - (settings.padding * 2)
                })
                settings.scrollbar($(settings.slide) && $(settings.pagecontent));
                //获取设置url
                $.getUrlParam = function(name) {
                    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                    var r = window.location.search.substr(1).match(reg);
                    if(r != null) return unescape(r[2]);
                    return null;
                }
                var id = $.getUrlParam('fid'); //获取其中的参数值
                //编辑数据
                var advertisMore = function(callback) {
                    $.ajax({
                        url: "asserts/json/farmer.json",
                        type: "GET",
                        dataType: 'json',
                        success: function(ret) {
                            typeof callback == 'function' && callback(ret);
                        },
                    });
                };
                advertisMore(function(listArr) {
                    var listhtml = $('#productlist');
                    var html = template('producthtml', {
                        id: id,
                        list: listArr.data,
                        sorts: listArr.sort
                    });
                    var s = listArr.data.length;
                    $("#quantity").html(s);

                    listhtml.append(html);
                    new TableSorter("tableList", 4, 5, 7, 9); //设置
                    $("#situation").Hupage({});//加载完数据执行
                });
            } //自定义方法
        });
    })
</script>

<style type="text/css">
    .message{
        font-size: 12px;
        color: red;
    }
</style>
<script type="text/javascript">
    const E = window.wangEditor
    const editor = new E('#div1')
    //const editor = new E(document.getElementById("div1"))
    // 配置 server 接口地址
    // 默认情况下，只有 IE 和 旧版 Edge 会使用兼容模式，如果需要在其它浏览器上也使用兼容模式，可以在函数内进行判定
    editor.config.compatibleMode = function () {
        // 返回 true 表示使用兼容模式；返回 false 使用标准模式
        return true
    }
    // 隐藏“网络图片”tab
    editor.config.showLinkImg = false;
    // 关闭粘贴内容中的样式
    editor.config.pasteFilterStyle = false;
    // 忽略粘贴内容中的图片
    editor.config.pasteIgnoreImg = true;
    //上传图片时，可自定义filename（controller层需要设置传入的名字时保持一致）
    editor.config.uploadFileName = 'myFile';
    // 配置服务器端地址 upload:上传图片地址（调用controller层接口）
    editor.config.uploadImgServer='case/uploadImg';

    // 当我们使用兼容模式的时候，可以自定义记录的频率，默认 200 ms
    editor.config.onchangeTimeout = 500 // 修改为 500 ms

    // 还可以修改历史记录的步数。默认 30 步
    editor.config.historyMaxSize = 50 // 修改为 50 步
    //可使用监听函数在上传图片的不同阶段做相应处理
    editor.config.uploadImgHooks = {
        before: function (xhr, editor, files) {
            // 图片上传之前触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，files 是选择的图片文件
            // 如果返回的结果是 {prevent: true, msg: 'xxxx'} 则表示用户放弃上传
            // return {
            //     prevent: true,
            //     msg: '放弃上传'
            // }
        },
        success: function (xhr, editor, result) {
            // 图片上传并返回结果，图片插入成功之后触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，result 是服务器端返回的结果
        },
        fail: function (xhr, editor, result) {
            // 图片上传并返回结果，但图片插入错误时触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象，result 是服务器端返回的结果
        },
        error: function (xhr, editor) {
            // 图片上传出错时触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象
        },
        timeout: function (xhr, editor) {
            // 图片上传超时时触发
            // xhr 是 XMLHttpRequst 对象，editor 是编辑器对象
        },
        // 如果服务器端返回的不是 {errno:0, data: [...]} 这种格式，可使用该配置
        // （但是，服务器端返回的必须是一个 JSON 格式字符串！！！否则会报错）
        customInsert: function (insertImg, result, editor) {
            // 图片上传并返回结果，自定义插入图片的事件（而不是编辑器自动插入图片！！！）
            // insertImg 是插入图片的函数，editor 是编辑器对象，result 是服务器端返回的结果
            // 举例：假如上传图片成功后，服务器端返回的是 {url:'....'} 这种格式，即可这样插入图片：
            insertImg(result.data)
            // result 必须是一个 JSON 格式字符串！！！否则报错
        }
    }
    editor.config.uploadImgHeaders = {
        Accept: 'text/x-json,application/json, text/javascript, */*',
    }
    editor.config.excludeMenus = [
        'emoticon',
        'video'
    ]
    editor.create()
</script>
